<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ch1Q1</title>

<style>
:root{
  --bg:#E6EEE9;
  --box:#1F6B52;
  --top:#0B3D2E;
  --text:#0B3D2E;
  --reveal:#ffffffee;
  --stroke:#cfe1da;
  --glow: 0 0 0 2px rgba(11,61,46,.15), 0 10px 30px rgba(11,61,46,.18);
  --glowStrong: 0 0 0 3px rgba(11,61,46,.25), 0 18px 40px rgba(11,61,46,.25);

  --grid-top: 18%;
  --grid-left: 6%;
  --grid-width: 88%;
  --grid-height: 36%;
  --pyr-gap: 3%;
  --frame-pad: 14px;
}

*{ box-sizing:border-box; }

body{
  font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}

.stage{
  width:min(1100px,100%);
  aspect-ratio:16/9;
  background: var(--bg);
  margin:auto;
  position:relative;
  overflow:hidden;
  border:1px solid var(--stroke);
  border-radius:14px;
  box-shadow: 0 18px 55px rgba(0,0,0,.12);
}

/* pattern */
.stage::before{
  content:"";
  position:absolute; inset:0;
  background-image:
    repeating-radial-gradient(circle at 30% 30%,
      rgba(11,61,46,.06) 0 1px,
      transparent 1px 28px),
    repeating-radial-gradient(circle at 70% 65%,
      rgba(11,61,46,.05) 0 1px,
      transparent 1px 32px);
  opacity:.50;
  pointer-events:none;
}
.stage::after{
  content:"";
  position:absolute; inset:-40px;
  background: radial-gradient(circle at center, transparent 55%, rgba(0,0,0,.10) 110%);
  pointer-events:none;
}

/* Box 1 */
.box1{
  position:absolute;
  top:22px;
  left:50%;
  transform:translateX(-50%);
  width:46%;
  height:9%;
  background: linear-gradient(180deg, rgba(11,61,46,1), rgba(9,52,39,1));
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:1000;
  font-size:22px;
  cursor:pointer;
  user-select:none;
  border-radius:12px;
  box-shadow: var(--glow);
  z-index:3;
  padding: 0 14px;
  text-align:center;
}
.box1:hover{ box-shadow: var(--glowStrong); transform:translateX(-50%) translateY(-1px); }
.box1.revealed{ cursor:default; }
.box1 span{ display:block; width:100%; }

/* Grid */
.mainGrid{
  position:absolute;
  top: var(--grid-top);
  left: var(--grid-left);
  width: var(--grid-width);
  height: var(--grid-height);
  display:grid;
  grid-template-columns: 20% 16% 22% 30%;
  grid-template-rows: repeat(3, 1fr);
  gap:18px 18px;
  align-items:center;
  z-index:2;
}

.label{
  font-weight:1000;
  font-size:26px;
  text-align:center;
  color:var(--text);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  pointer-events:none;
}

.gameBox{
  background: linear-gradient(180deg, rgba(31,107,82,1), rgba(26,92,71,1));
  color:#fff;
  border-radius:12px;
  cursor:pointer;
  user-select:none;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-weight:1000;
  padding:12px 14px;
  min-height:56px;
  box-shadow: var(--glow);
  transform: translateY(0);
  transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
  position:relative;
  overflow:hidden;
}
.gameBox:hover{ transform: translateY(-2px); box-shadow: var(--glowStrong); filter:saturate(1.05); }
.gameBox:active{ transform: translateY(0px) scale(.995); }

.gameBox .num{ font-size:22px; line-height:1; }
.gameBox .clue{
  display:none;
  width:100%;
  color:var(--text);
  line-height:1.35;
  white-space:pre-line;
  font-size:16px;
}

.gameBox.revealed{
  background: var(--reveal);
  color: var(--text);
  cursor:default;
  border:2px solid rgba(11,61,46,.35);
  box-shadow: 0 0 0 3px rgba(11,61,46,.12), 0 16px 38px rgba(11,61,46,.18);
}
.gameBox.revealed .num{ display:none; }
.gameBox.revealed .clue{ display:block; }

.gameBox.disabled{
  pointer-events:none;
  opacity:.65;
  filter: grayscale(.15);
}

/* Pyramid */
.pyramidWrap{
  position:absolute;
  right: calc(var(--frame-pad) + 10px);
  top: calc(var(--grid-top) + var(--grid-height) + var(--pyr-gap));
  bottom: var(--frame-pad);
  width:40%;
  display:flex;
  align-items:flex-end;
  justify-content:flex-end;
  overflow:hidden;
  pointer-events:none;
  z-index:1;
}
.pyramidWrap img{
  width:100%;
  height:100%;
  object-fit:contain;
  filter: drop-shadow(0 14px 26px rgba(0,0,0,.10));
}

/* HUD: under boxes */
.hud{
  position:absolute;
  left: var(--frame-pad);
  top: calc(var(--grid-top) + var(--grid-height) + 16px);
  width:min(420px, 46%);
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:3;
}

.pill{
  background: rgba(255,255,255,.92);
  padding:10px 12px;
  border-radius:999px;
  font-weight:1000;
  font-size:14px;
  border:1px solid var(--stroke);
  box-shadow: 0 8px 22px rgba(11,61,46,.10);
  color:var(--text);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}

.btnRow{
  display:flex;
  gap:10px;
  align-items:stretch;
}

.btn{
  flex:1;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(11,61,46,.25);
  background: linear-gradient(180deg, rgba(11,61,46,1), rgba(9,52,39,1));
  color:#fff;
  font-weight:1000;
  cursor:pointer;
  box-shadow: 0 10px 28px rgba(11,61,46,.18);
  transition: transform .12s ease, box-shadow .2s ease, opacity .2s ease;
}
.btn:hover{ transform: translateY(-1px); box-shadow: 0 14px 34px rgba(11,61,46,.22); }
.btn:active{ transform: translateY(0); opacity:.95; }

.btn.danger{
  background: linear-gradient(180deg, #7c1f1f, #5a1414);
  border-color: rgba(124,31,31,.35);
}

.btn.secondary{
  background:#ffffff;
  color:var(--text);
  border-color: rgba(11,61,46,.25);
}

.msg{ font-weight:1000; font-size:14px; padding:4px 2px; color:var(--text); }
.ok{ color:#0b6b0b; }
.bad{ color:#b00020; }
.strike{ font-size:18px; letter-spacing:2px; }
.excl{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  background: rgba(176,0,32,.10);
  color:#b00020;
  border:1px solid rgba(176,0,32,.18);
  font-size:12px;
}
</style>
</head>

<body>
<div class="stage">

  <div class="box1" id="box1" title="Ø§ÙØªØ­ Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø±"><span>1</span></div>

  <div class="mainGrid">
    <div class="label">Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¹Ø·Ø±ÙŠØ©</div>
    <div class="gameBox" data-id="2"><div class="num">2</div><div class="clue"></div></div>
    <div class="label">Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©</div>
    <div class="gameBox" data-id="5"><div class="num">5</div><div class="clue"></div></div>

    <div class="label">Ø§Ù„Ø¹Ø·Ø§Ø±</div>
    <div class="gameBox" data-id="3"><div class="num">3</div><div class="clue"></div></div>
    <div class="label">Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ø·Ø±</div>
    <div class="gameBox" data-id="6"><div class="num">6</div><div class="clue"></div></div>

    <div class="label">Ø³Ù†Ø© Ø§Ù„Ø¥ØµØ¯Ø§Ø±</div>
    <div class="gameBox" data-id="4"><div class="num">4</div><div class="clue"></div></div>
    <div class="label">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø·Ø±</div>
    <div class="gameBox" data-id="7"><div class="num">7</div><div class="clue"></div></div>
  </div>

  <div class="pyramidWrap" aria-hidden="true">
    <img id="pyramidImg" src="" alt="Ø§Ù„Ø§Ù†Ø·Ø¨Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
  </div>

  <div class="hud">
    <div class="pill"><span>Ø§Ù„Ø¯ÙˆØ±</span><span id="turnName">â€”</span></div>
    <div class="pill"><span>Ù†Ù‚Ø§Ø· Ø§Ù„Ù„ÙˆØ­Ø©</span><span id="points">50</span></div>

    <div class="pill">
      <span id="p1Label">Ù„Ø§Ø¹Ø¨ 1</span>
      <span><b id="s1">0</b> <span class="strike" id="strike1"></span> <span id="ex1"></span></span>
    </div>

    <div class="pill">
      <span id="p2Label">Ù„Ø§Ø¹Ø¨ 2</span>
      <span><b id="s2">0</b> <span class="strike" id="strike2"></span> <span id="ex2"></span></span>
    </div>

    <div class="btnRow">
      <button class="btn" id="wrongBtn">Ø®Ø·Ø£</button>
      <button class="btn danger" id="resetBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø³Ø¤Ø§Ù„</button>
      <button class="btn secondary" id="lockBtn">ØªØ«Ø¨ÙŠØª Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø¹ÙˆØ¯Ø©</button>
    </div>

    <div class="msg" id="msg"></div>
  </div>

</div>

<script>
/* Auto-load pyramid image: questions/Ch1Q1.html -> ../images/Ch1Q1.png */
(function(){
  const file = (location.pathname.split("/").pop() || "").split("?")[0];
  const base = file.replace(/\.html$/i, "");
  document.getElementById("pyramidImg").src = `../images/${base}.png`;
})();

/* Player names across tabs: localStorage first, then sessionStorage */
function getPlayerName(key, fallback){
  return (
    (localStorage.getItem(key) || "").trim() ||
    (sessionStorage.getItem(key) || "").trim() ||
    fallback
  );
}
const P1_NAME = getPlayerName("jawalat_p1", "Ù„Ø§Ø¹Ø¨ 1");
const P2_NAME = getPlayerName("jawalat_p2", "Ù„Ø§Ø¹Ø¨ 2");
document.getElementById("p1Label").textContent = P1_NAME;
document.getElementById("p2Label").textContent = P2_NAME;

/* Q1 data */
const board = {
  perfumeName: "Kenzo Homme Indigo",
  clues: {
    2: "Kenzo",
    3: "Quentin Bisch",
    4: "2025",
    5: "Ù†Ø³ÙŠÙ… Ø§Ù„Ø¨Ø­Ø±",
    6: "Ø§Ù„Ø³ÙˆØ³Ù†",
    7: "Ø§Ù„Ø¬Ù„ÙˆØ¯ØŒ Ø®Ø´Ø¨ Ø§Ù„ØµÙ†Ø¯Ù„ØŒ Ø£ÙƒÙŠØºØ§Ù„Ø§ÙˆÙˆØ¯"
  }
};

/* Scoring */
const START_POINTS = 50;
const REVEAL_PENALTY = 5;
const MIN_POINTS = 5;

/* State */
let turn = 0;
let scores = [0,0];
let strikes = [0,0];
let revealedCount = 0;
let roundEnded = false;

/* Elements */
const el = {
  box1: document.getElementById("box1"),
  turnName: document.getElementById("turnName"),
  points: document.getElementById("points"),
  s1: document.getElementById("s1"),
  s2: document.getElementById("s2"),
  strike1: document.getElementById("strike1"),
  strike2: document.getElementById("strike2"),
  ex1: document.getElementById("ex1"),
  ex2: document.getElementById("ex2"),
  msg: document.getElementById("msg"),
  wrongBtn: document.getElementById("wrongBtn"),
  resetBtn: document.getElementById("resetBtn"),
  lockBtn: document.getElementById("lockBtn"),
};

function calcPoints(){
  return Math.max(MIN_POINTS, START_POINTS - (revealedCount * REVEAL_PENALTY));
}
function setMsg(html){ el.msg.innerHTML = html || ""; }
function isExcluded(p){ return strikes[p] >= 2; }

function fitTextToBox(container, minPx=12, maxPx=18){
  container.style.fontSize = maxPx + "px";
  for(let fs=maxPx; fs>=minPx; fs--){
    container.style.fontSize = fs + "px";
    if (container.scrollHeight <= container.clientHeight + 1) return;
  }
}

function playerName(i){ return i === 0 ? P1_NAME : P2_NAME; }

function updateHUD(){
  if (!roundEnded && isExcluded(turn) && !isExcluded(1-turn)) turn = 1 - turn;

  el.turnName.textContent = playerName(turn);
  el.points.textContent = roundEnded ? 0 : calcPoints();
  el.s1.textContent = scores[0];
  el.s2.textContent = scores[1];

  el.strike1.textContent = "ğŸ”´".repeat(strikes[0]);
  el.strike2.textContent = "ğŸ”´".repeat(strikes[1]);

  el.ex1.innerHTML = isExcluded(0) ? `<span class="excl">Ù…Ø³ØªØ¨Ø¹Ø¯</span>` : "";
  el.ex2.innerHTML = isExcluded(1) ? `<span class="excl">Ù…Ø³ØªØ¨Ø¹Ø¯</span>` : "";

  if (!roundEnded && isExcluded(0) && isExcluded(1)) endRoundNoPoints();
}

function revealAll(){
  document.querySelectorAll(".gameBox").forEach(box=>{
    const id = +box.dataset.id;
    box.classList.add("revealed","disabled");
    const clueEl = box.querySelector(".clue");
    clueEl.textContent = board.clues[id] ?? "â€”";
    requestAnimationFrame(()=>fitTextToBox(clueEl, 12, 18));
  });

  const span = el.box1.querySelector("span");
  span.textContent = board.perfumeName;
  el.box1.classList.add("revealed");
  requestAnimationFrame(()=>fitTextToBox(span, 14, 24));
}

function endRoundNoPoints(){
  roundEnded = true;
  revealAll();
  setMsg(`<span class="bad">Ø§Ù„Ø³Ø¤Ø§Ù„ ØµÙØ± Ù†Ù‚Ø§Ø· (Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø³ØªØ¨Ø¹Ø¯ÙŠÙ†)</span>`);
  updateHUD();
}

function switchTurnAfterAction(){
  if (isExcluded(0) && isExcluded(1)){
    endRoundNoPoints();
    return;
  }
  turn = 1 - turn;
  if (isExcluded(turn)) turn = 1 - turn;
  updateHUD();
}

/* Box 1 */
el.box1.addEventListener("click", ()=>{
  if (roundEnded) return;
  if (isExcluded(turn)) return;

  scores[turn] += calcPoints();
  roundEnded = true;
  revealAll();
  setMsg(`<span class="ok">ØªÙ… ÙØªØ­ Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø± âœ… Ù†Ù‚Ø§Ø· Ø§Ø­ØªÙØ³Ø¨Øª Ù„Ù€ ${playerName(turn)}</span>`);
  updateHUD();
});

/* Boxes 2-7 */
document.querySelectorAll(".gameBox").forEach(box=>{
  box.addEventListener("click", ()=>{
    if (roundEnded) return;
    if (isExcluded(turn)) return;
    if (box.classList.contains("revealed")) return;

    const id = +box.dataset.id;
    box.classList.add("revealed","disabled");
    const clueEl = box.querySelector(".clue");
    clueEl.textContent = board.clues[id] ?? "â€”";

    revealedCount++;
    setMsg(`Ø§Ù†ÙØªØ­ Ø±Ù‚Ù… <b>${id}</b> (-${REVEAL_PENALTY}). Ø§Ù„Ø¯ÙˆØ± Ù„Ù€ ${playerName(1-turn)}.`);
    requestAnimationFrame(()=>fitTextToBox(clueEl, 12, 18));

    switchTurnAfterAction();
  });
});

/* Wrong (Strike) */
el.wrongBtn.addEventListener("click", ()=>{
  if (roundEnded) return;
  if (isExcluded(turn)) return;

  strikes[turn]++;

  if (isExcluded(turn)){
    setMsg(`<span class="bad">Ø®Ø·Ø£ ğŸ”´ ${playerName(turn)} ØµØ§Ø± Ù…Ø³ØªØ¨Ø¹Ø¯ Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„.</span>`);
  } else {
    setMsg(`<span class="bad">Ø®Ø·Ø£ ğŸ”´ Ø§Ù„Ø¯ÙˆØ± Ù„Ù€ ${playerName(1-turn)}.</span>`);
  }

  switchTurnAfterAction();
});

/* Reset question only */
el.resetBtn.addEventListener("click", ()=>{
  turn = 0;
  scores = [0,0];
  strikes = [0,0];
  revealedCount = 0;
  roundEnded = false;
  setMsg("");

  const span = el.box1.querySelector("span");
  span.textContent = "1";
  span.style.fontSize = "";
  el.box1.classList.remove("revealed");

  document.querySelectorAll(".gameBox").forEach(box=>{
    box.classList.remove("revealed","disabled");
    const clueEl = box.querySelector(".clue");
    clueEl.textContent = "";
    clueEl.style.fontSize = "";
  });

  updateHUD();
});

/* Totals storage for the whole game */
function getTotals(){
  const raw = localStorage.getItem("jawalat_totals_v1");
  if(!raw) return { totals:[0,0] };
  try{
    const parsed = JSON.parse(raw);
    if(parsed?.totals?.length === 2) return parsed;
  }catch(e){}
  return { totals:[0,0] };
}
function saveTotals(totals){
  localStorage.setItem("jawalat_totals_v1", JSON.stringify({ totals }));
}

/* Lock points and go back to challenges */
el.lockBtn.addEventListener("click", ()=>{
  const store = getTotals();
  const totals = store.totals;

  totals[0] = (totals[0] || 0) + (scores[0] || 0);
  totals[1] = (totals[1] || 0) + (scores[1] || 0);

  saveTotals(totals);

  window.location.href = "../challenges.html";
});

updateHUD();
</script>
</body>
</html>
