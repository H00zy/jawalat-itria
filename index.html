<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>جولات عطرية - دخول</title>

<style>
:root{
  --bg:#E6EEE9;
  --deep:#0B3D2E;
  --mid:#1F6B52;
  --card:#ffffffee;
  --stroke:#cfe1da;
  --danger:#7c1f1f;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
  background:#f4f4f4;
  padding:22px;
}

.shell{
  max-width:1100px;
  margin:auto;
  background:var(--bg);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:24px;
  box-shadow:0 20px 60px rgba(0,0,0,.12);
  position:relative;
  overflow:hidden;
}

.shell::before{
  content:"";
  position:absolute; inset:0;
  background-image:
    repeating-radial-gradient(circle at 30% 30%,
      rgba(11,61,46,.06) 0 1px,
      transparent 1px 28px),
    repeating-radial-gradient(circle at 70% 65%,
      rgba(11,61,46,.05) 0 1px,
      transparent 1px 32px);
  opacity:.55;
  pointer-events:none;
}

.header{
  display:flex;
  justify-content:center;
  margin-bottom:18px;
}

.logo{
  width:min(520px, 92vw);
  height:auto;
  filter: drop-shadow(0 10px 25px rgba(0,0,0,.10));
}

.card{
  max-width:720px;
  margin:auto;
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:20px;
  box-shadow:0 14px 40px rgba(0,0,0,.08);
}

.title{
  text-align:center;
  font-size:22px;
  font-weight:1100;
  color:var(--deep);
  margin-bottom:12px;
}

.row{
  display:flex;
  justify-content:center;
  margin-top:10px;
}

.input{
  width:min(420px, 92vw);
  background:#fff;
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:12px;
  font-weight:900;
  outline:none;
}

.input:focus{
  border-color: rgba(11,61,46,.35);
  box-shadow: 0 0 0 3px rgba(11,61,46,.12);
}

.btnRow{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:16px;
  flex-wrap:wrap;
}

.btn{
  min-width:180px;
  border:1px solid rgba(11,61,46,.25);
  background: linear-gradient(180deg, var(--mid), #16604a);
  color:#fff;
  font-weight:1100;
  padding:12px 14px;
  border-radius:14px;
  cursor:pointer;
  transition:.15s;
}
.btn:hover{ transform: translateY(-1px); }
.btn:active{ transform: translateY(0); opacity:.96; }

.btn.secondary{
  background:#fff;
  color:var(--deep);
}

.msg{
  text-align:center;
  margin-top:10px;
  font-weight:1000;
  color:var(--danger);
}

.hidden{ display:none; }
</style>
</head>

<body>
<div class="shell">

  <div class="header">
    <img class="logo" src="images/logo.png" alt="جولات عطرية">
  </div>

  <!-- Step 1: Password -->
  <div class="card" id="step1">
    <div class="title">الدخول</div>
    <div class="row">
      <input id="pw" class="input" type="password" placeholder="كلمة المرور..." autocomplete="off">
    </div>
    <div class="btnRow">
      <button class="btn" id="checkBtn">دخول</button>
    </div>
    <div class="msg" id="pwMsg"></div>
  </div>

  <!-- Step 2: Player Names -->
  <div class="card hidden" id="step2">
    <div class="title">أسماء المتسابقين</div>

    <div class="row">
      <input id="p1" class="input" placeholder="اسم المتسابق الأول">
    </div>

    <div class="row">
      <input id="p2" class="input" placeholder="اسم المتسابق الثاني">
    </div>

    <div class="btnRow">
      <button class="btn" id="startBtn">ابدأ</button>
      <button class="btn secondary" id="backBtn">رجوع</button>
    </div>

    <div class="msg" id="nameMsg"></div>
  </div>

</div>

<script>
const PASSWORD = "Ch1Q1";

const step1 = document.getElementById("step1");
const step2 = document.getElementById("step2");
const pw = document.getElementById("pw");
const pwMsg = document.getElementById("pwMsg");

const p1 = document.getElementById("p1");
const p2 = document.getElementById("p2");
const nameMsg = document.getElementById("nameMsg");

function showStep(n){
  step1.classList.toggle("hidden", n !== 1);
  step2.classList.toggle("hidden", n !== 2);
  pwMsg.textContent = "";
  nameMsg.textContent = "";
}

/* ✅ عبّي الأسماء لو محفوظة (حتى لو رجعت للصفحة لأي سبب) */
function fillSavedNames(){
  const saved1 = (localStorage.getItem("jawalat_p1") || sessionStorage.getItem("jawalat_p1") || "").trim();
  const saved2 = (localStorage.getItem("jawalat_p2") || sessionStorage.getItem("jawalat_p2") || "").trim();
  if(saved1) p1.value = saved1;
  if(saved2) p2.value = saved2;
}

document.getElementById("checkBtn").addEventListener("click", ()=>{
  if((pw.value || "").trim() !== PASSWORD){
    pwMsg.textContent = "كلمة المرور غير صحيحة";
    return;
  }

  // ✅ حفظ auth في الاثنين (عشان التبويبات المختلفة)
  sessionStorage.setItem("jawalat_authed", "1");
  localStorage.setItem("jawalat_authed", "1");

  showStep(2);
  fillSavedNames();
  p1.focus();
});

pw.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){
    document.getElementById("checkBtn").click();
  }
});

document.getElementById("backBtn").addEventListener("click", ()=>{
  showStep(1);
});

document.getElementById("startBtn").addEventListener("click", ()=>{
  const n1 = (p1.value || "").trim();
  const n2 = (p2.value || "").trim();

  if(!n1 || !n2){
    nameMsg.textContent = "يرجى إدخال اسمي المتسابقين";
    return;
  }

  // ✅ تخزين الأسماء في الاثنين
  sessionStorage.setItem("jawalat_p1", n1);
  sessionStorage.setItem("jawalat_p2", n2);

  localStorage.setItem("jawalat_p1", n1);
  localStorage.setItem("jawalat_p2", n2);

  window.location.href = "rounds.html";
});

/* ✅ لو سبق الدخول، افتح خطوة الأسماء مباشرة */
if(
  sessionStorage.getItem("jawalat_authed") === "1" ||
  localStorage.getItem("jawalat_authed") === "1"
){
  showStep(2);
  fillSavedNames();
}
</script>
</body>
</html>
